"use strict";(self["webpackChunkvue_shopping"]=self["webpackChunkvue_shopping"]||[]).push([[442],{7442:function(t,e,s){s.r(e),s.d(e,{default:function(){return p}});var i=function(){var t=this,e=t._self._c;return e("div",[e("van-nav-bar",{attrs:{title:"會員登入","left-arrow":""},on:{"click-left":function(e){return t.$router.go(-1)}}}),e("div",{staticClass:"form"},[t._m(0),e("div",{staticClass:"usernumber marginB20"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.mobile,expression:"mobile"}],attrs:{type:"text",placeholder:"請輸入手機號碼"},domProps:{value:t.mobile},on:{input:function(e){e.target.composing||(t.mobile=e.target.value)}}})]),e("div",{staticClass:"userchickJpg flexs marginB20"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.picCode,expression:"picCode"}],attrs:{type:"text",placeholder:"請輸入圖形驗證碼"},domProps:{value:t.picCode},on:{input:function(e){e.target.composing||(t.picCode=e.target.value)}}}),e("img",{directives:[{name:"show",rawName:"v-show",value:t.picUrl,expression:"picUrl"}],staticClass:"point",attrs:{src:t.picUrl,alt:""},on:{click:t.createdGetUrl}})]),e("div",{staticClass:"userchick flexs"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.smgCode,expression:"smgCode"}],attrs:{type:"text",placeholder:"請輸入短信驗證碼246810"},domProps:{value:t.smgCode},on:{input:function(e){e.target.composing||(t.smgCode=e.target.value)}}}),t.timer?e("button",{staticClass:"chickButton2"},[t._v(t._s(`請等待${t.second}秒`))]):e("button",{staticClass:"chickButton point",on:{click:t.getCode}},[t._v("發送驗證碼")])]),e("van-button",{staticClass:"submit",attrs:{round:"",block:"",type:"info","native-type":"submit"},on:{click:t.login}},[t._v("提交")])],1)],1)},a=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"title"},[e("h2",[t._v("手機登入")]),e("p",[t._v("未註冊的手機登入後將自動註冊")])])}],o=s(4471);const r=function(){return o.Z.get("/captcha/image")},n=(t,e,s)=>o.Z.post("/captcha/sendSmsCaptcha",{form:{captchaCode:t,captchaKey:e,mobile:s}}),c=(t,e)=>o.Z.post("/passport/login",{form:{isParty:!1,partyData:{},mobile:t,smsCode:e}});var l={name:"loginIndex",data(){return{picCode:"",picKey:"",totalSecond:5,second:5,timer:null,mobile:"0912345678",picUrl:"",smgCode:"246810"}},created(){this.getUrl(),this.createdGetUrl=this.getButton()},destroyed(){clearInterval(this.timer)},methods:{getButton(){let t;return()=>{clearTimeout(t),t=setTimeout((async()=>{await this.getUrl(),this.$toast("驗證圖片已更新")}),300)}},async getUrl(){const{data:{base64:t,key:e}}=await r();this.picUrl=t,this.picKey=e},validFn(){return/^09\d{8}$/.test(this.mobile)?!!/^\w{4}$/.test(this.picCode)||(this.$toast("請輸入正確的圖形驗證碼"),!1):(this.$toast("請輸入正確的手機號碼"),!1)},async getCode(){if(this.validFn()&&!this.timer&&this.second===this.totalSecond){const t=await n(this.picCode,this.picKey,this.mobile);this.timer=setInterval((()=>{this.second--,this.second<=0&&(clearInterval(this.timer),this.timer=null,this.second=this.totalSecond)}),1e3),this.$toast(t.message)}},async login(){if(!this.validFn())return;if(!/^\d{6}$/.test(this.smgCode))return void this.$toast("短信驗證碼錯誤");const t=await c(this.mobile,this.smgCode);this.$store.commit("user/setUserInfo",t.data),this.$toast("登入成功");const e=this.$route.query.backUrl||"/";this.$router.replace(e)}}},d=l,u=s(1001),m=(0,u.Z)(d,i,a,!1,null,"3abd2599",null),p=m.exports}}]);
//# sourceMappingURL=442.d10448d2.js.map